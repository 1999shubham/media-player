<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="create_run_jar" name="Create Runnable Jar for Project com.upnp.mediaplayer with libraries in sub-folder" basedir="$basedir">
	<!--this file was created by Eclipse Runnable JAR Export Wizard-->
	<!--ANT 1.7 is required    
	                                -->
	<property name="builddir" value="${basedir}/build" />
	<property name="buildbeta" value="${builddir}/beta" />
	<property name="buildbetamediaplayer" value="${buildbeta}/mediaplayer" />
	<property name="beta_libs_raspihf" value="${buildbeta}/libs/raspi/hard_float" />
	<property name="beta_libs_jar" value="${buildbeta}/libs/jar" />

	<target name="create_run_jar">

		<!--<jar destfile="C:/Keep/Code/UPNP/mediaplayer/Beta/mediaplayer.jar" update="false">-->
		<jar destfile="${buildbetamediaplayer}/mediaplayer.jar" update="false">
			<manifest>
				<attribute name="Main-Class" value="org.rpi.main.StartMe" />
				<attribute name="Class-Path" value=". mediaplayer_lib/ohnet-Pete.jar mediaplayer_lib/log4j-1.2.16.jar mediaplayer_lib/jspf.core-1.0.2.jar" />
			</manifest>
			<fileset dir="C:/Keep/git/repository/MediaPlayer/com.upnp.mediaplayer/bin">
				<exclude name="**/plugin/**" />
			</fileset>
		</jar>
		<delete dir="${buildbetamediaplayer}/mediaplayer_lib" />
		<mkdir dir="${buildbetamediaplayer}/mediaplayer_lib" />
		<copy file="${beta_libs_jar}/ohnet-Pete.jar" todir="${buildbetamediaplayer}/mediaplayer_lib" />
		<copy file="C:/Keep/Repository/java/log4j/log4j/1.2.16/apache-log4j-1.2.16/log4j-1.2.16.jar" todir="${buildbetamediaplayer}/mediaplayer_lib" />
		<copy file="C:/Keep/Repository/java/jspf/dist/jspf.core-1.0.2.jar" todir="${buildbetamediaplayer}/mediaplayer_lib" />
		<!--
        <copy file="C:/Keep/Repository/java/quartz/quartz/2.1.1/quartz-2.1.1.jar" todir="C:/Keep/Code/UPNP/mediaplayer/Beta/mediaplayer_lib"/>
        <copy file="C:/Keep/Repository/java/quartz/quartz/2.1.1/lib/slf4j-api-1.6.1.jar" todir="C:/Keep/Code/UPNP/mediaplayer/Beta/mediaplayer_lib"/>
        <copy file="C:/Keep/Repository/java/quartz/quartz/2.1.1/lib/slf4j-log4j12-1.6.1.jar" todir="C:/Keep/Code/UPNP/mediaplayer/Beta/mediaplayer_lib"/>
        <copy file="C:/Keep/Repository/java/pi4j/pi4j-1.0-SNAPSHOT/lib/pi4j-core.jar" todir="C:/Keep/Code/UPNP/mediaplayer/Beta/mediaplayer_lib"/>
    	-->
		<copy file="C:\Keep\git\repository\MediaPlayer\com.upnp.mediaplayer\license.txt" todir="C:/Keep/Code/UPNP/mediaplayer/Beta" />
	</target>
	<target name="deployStudy">
		<antcall target="CopyFilesToRaspi">
			<param name="server_name" value="rpistudy.local" />
		</antcall>
	</target>

	<target name="deployLounge">
		<antcall target="CopyFilesToRaspi">
			<param name="server_name" value="rpilounge.local" />
		</antcall>
	</target>
	<target name="deployBedroom">
		<antcall target="CopyFilesToRaspi">
			<param name="server_name" value="rpibedroom.local" />
		</antcall>
	</target>

	<target name="CopyFilesToRaspi">
		<echo>Sending to ${server_name}</echo>
		<scp remoteTodir="root:root@${server_name}:/home/pi/mediaplayer" trust="yes" sftp="true">
			<fileset dir="${buildbeta}/mediaplayer">
				<include name="mediaplayer.jar" />
			</fileset>
		</scp>
		<scp remoteTodir="root:root@${server_name}:/home/pi/mediaplayer/mediaplayer_lib" trust="yes" sftp="true">
			<fileset dir="${beta_libs_jar}">
				<include name="ohnet-Pete.jar" />
			</fileset>
		</scp>
		<scp remoteTodir="root:root@${server_name}:/usr/local/lib" trust="yes" sftp="true">
			<fileset dir="${buildbeta}/libs/raspi/hard_float">
				<include name="*.so" />
			</fileset>
		</scp>
		<sshexec host="${server_name}" username="root" password="root" command="sudo reboot" trust="true" />
	</target>


	<target name="getLibsHardFlost">
		<echo>Get .so from rpistudy</echo>
		<scp remoteFile="root:root@rpistudy.local:/home/pi/ohNet/Build/Obj/Posix/Release/*.so" trust="yes" sftp="true" todir="${beta_libs_raspihf}">
		</scp>
		<scp file="root:root@rpistudy.local:/home/pi/ohNet/Build/Obj/Posix/Release/org" trust="yes" sftp="true" todir="${beta_libs_jar}/classes/org">
		</scp>
		<zip destfile="${beta_libs_jar}/ohnet-Pete.jar" basedir="${beta_libs_jar}/classes" update="true" />
		<delete dir="${beta_libs_jar}/classes" />
	</target>

	<target name="All">
		<antcall target="create_run_jar" />

		<antcall target="deployStudy" />
		<antcall target="deployLounge" />
		<antcall target="deployBedroom" />

	</target>
</project>
